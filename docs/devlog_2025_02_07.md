# Dev Log - February 7, 2025

## Current Issues

### PATTERN Menu Issues
1. COPY/PASTE Functionality:
   - COPY operation not working on either bank
   - PASTE option remains after execution (not cycling back to COPY)
   - COPY->PASTE->COPY cycle broken
   - Possible state management issue in `has_copy` and `copy_buffer.has_data` flags

2. Bank Operations:
   - SAVE appears to only work with Bank B
   - Bank A save/load operations non-functional
   - Loading only recovers Bank B data after restart
   - May indicate issue with bank address mapping or SRAM handling

## Progress Made
- Successfully fixed menu visibility issues during operations
- CLEAR operation functionality restored
- Fixed some underlying state management issues
- Improved menu redraw handling

## Technical Notes
1. State Management:
   - Need to review interaction between `prompt_state` and `pending_operation`
   - Copy buffer state not properly resetting after paste operation
   - Menu state transitions need cleanup

2. SRAM Handling:
   - Bank A data possibly not being written to correct SRAM location
   - Need to verify bank switching logic during save/load
   - Potential issue with bank data structure alignment

3. Menu Rendering:
   - Fixed issue with menu becoming invisible during operations
   - Added proper state preservation during delayed operations
   - Need to ensure consistent menu state during bank switches

## Next Steps
1. Short Term:
   - Debug Bank A save/load operations priority
   - Fix COPY/PASTE state cycling
   - Review bank data storage implementation

2. Investigation Needed:
   - Verify SRAM bank mapping
   - Check copy buffer memory structure
   - Review bank switching timing
   - Test bank data integrity after operations

3. Potential Solutions:
   - Implement state validation for copy operations
   - Add debug logging for bank operations
   - Consider restructuring bank data storage

## Notes for Next Session
- Bring back working version of copy/paste from previous implementation
- Compare SRAM handling between banks
- Consider adding debug visualization for bank state
- Test each bank operation in isolation