# Development Notes - February 3, 2025 (Part 4)

## Pattern Bank Implementation Plan

### Phase 1: Basic Bank Structure
1. Update sequencer.h
   - Add bank identifier (PATTERN:A/B)
   - Add copy buffer structure
   - Add bank switch handling
   - Update SEQUENCER_DATA structure

2. Update Main Menu
   - Change PATTERN:1 to PATTERN:A
   - Implement bank switching logic
   - Add pattern completion check for switching

### Phase 2: Prompt UI
1. Create Pop-up System
   - Border drawing (TILE_SELECTED)
   - Menu option layout
   - Cursor navigation
   - YES/NO confirmation

2. Implement Actions
   - SAVE functionality
   - LOAD functionality
   - COPY/PASTE system
   - CLEAR operation

### Phase 3: Save System
1. MBC1 Setup
   - Implement bank switching
   - Setup RAM banks
   - Add save verification

2. Save Data Organization
   - Pattern bank storage
   - Copy buffer handling
   - Current bank state

### Implementation Order
1. Bank switching core functionality
2. UI prompt system
3. Basic actions without save
4. MBC1 integration
5. Persistent storage
6. Error handling

### Key Considerations
- Pattern playback continuity
- Bank switch timing
- Copy buffer persistence
- Error message system
- Save data verification

### Data Structures
```c
// New structures needed:
typedef struct {
    UINT8 bank_id;        // A or B
    UINT8 is_switching;   // Flag for bank switch in progress
    UINT8 switch_pending; // Steps remaining until switch
    UINT8 has_copy;       // Copy buffer status
} BANK_DATA;

// Update to SEQUENCER_DATA:
    BANK_DATA bank;
    CHANNEL_DATA copy_buffer[SEQ_NUM_CHANNELS];
```

### Next Steps
1. Begin with bank switching implementation
2. Add basic A/B bank support
3. Implement pattern preservation