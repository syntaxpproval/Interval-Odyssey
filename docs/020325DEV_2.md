# Development Notes - February 3, 2025 (Part 2)

## MBC1 Implementation Research

### Key MBC1 Specifications
- ROM: Up to 2MB (125 16KB banks)
- RAM: Up to 32KB (4 8KB banks)
- Default ROM bank: Bank 0 (fixed at 0x0000-0x3FFF)
- Switchable ROM bank: Bank 1+ (0x4000-0x7FFF)
- Memory registers:
  - 0x2000-0x3FFF: ROM Bank Number
  - 0x4000-0x5FFF: RAM Bank Number / Upper ROM Bank bits
  - 0x6000-0x7FFF: Banking Mode Select

### Required Changes
1. Header Modifications
   ```
   0x147 - Cartridge Type: 0x03 (MBC1+RAM+BATTERY)
   0x148 - ROM Size: Based on final size (0x01 for 64KB, 0x02 for 128KB, etc.)
   0x149 - RAM Size: Based on save requirements (0x02 for 8KB, 0x03 for 32KB)
   ```

2. Bank Organization Plan
   - Bank 0: Core game code, interrupt handlers, critical functions
   - Bank 1: Main game logic
   - Bank 2: Sequencer & sound engine
   - Bank 3: Chord data & patterns
   - Bank 4: Additional game modes
   - Bank 5+: Reserved for expansion

### Code Structure Changes
1. Bank Switching
   ```c
   // Bank switching function
   void switch_bank(UINT8 bank) {
       *((UINT8 *)0x2000) = bank;
   }
   ```

2. Data Organization
   - Identify which code/data needs to be bank-resident (always in Bank 0)
   - Move bank-switchable code to appropriate banks
   - Update build system to support multiple banks

### Build System Updates Needed
1. Makefile modifications for multi-bank compilation
2. Bank assignment directives in source files
3. Linker script updates for bank layout

### Next Steps
1. Verify current code bank requirements
2. Test MBC1 bank switching in emulator
3. Plan data/code distribution across banks
4. Update build system for banking support

### Questions to Resolve
1. Save data requirements?
2. Minimum RAM bank needs?
3. Optimal bank size for chord data?
4. Development toolchain MBC support?